<div class="container">
    <h1 class="text-center">Music from your fav artist</h1>
    <hr class="bg-primary">
    <div class="container">
        <div class="row">
            <div id="cover-art" class="col-md-3">
            </div>
            <div id="music-info" class="col-md-9 text-center">

            </div>
        </div>
    </div>
</div>

   
<script>

    var user = <%- JSON.stringify(user) %>;
    var userArtist = user.topics[0].artistName;
    function parseArtist (str) {
        str = str.toLowerCase();
        str = str.replace(/\s{2,}/g,' ').trim();
        str = str.replace(/\s/g, '+')
        return str 
    }
    userArtist = parseArtist(userArtist)
    var musicApi = `https://itunes.apple.com/search?media=music&limit=10&entity=musicTrack&term=${userArtist}`
    var videoApi = `https://itunes.apple.com/search?media=music&limit=10&entity=musicVideo&term=${userArtist}`
    var music
    var i = 0
    $.ajax({
        url: musicApi,
        method: 'get',
        dataType: 'json'
    })
    .done((res, body) => {
        var results = res.results
        console.log(results)
    
        var generateContent = function(i) {
            music = results[i]
            len = results.length - 1
            // for cover art
            var $coverArt = $('<img>')
            $coverArt.attr('src', music.artworkUrl100).attr('style', 'width:100%;')
            var $caption = $('<figcaption>')
            $caption.text(music.collectionName)
            $('#cover-art').empty().append($coverArt, $caption)
            // for music info
            var $h2 = $(`<h2>${music.artistName}</h2>`);
            var $div = $('<div class="container">')
            var $h3 = $(`<h3>${music.trackName}</h3>`)
            var $audioPlayer = $(`<audio src="${music}" controls>Your browser doesn't support the audio element</audio>`)
    
            $('#music-info').empty().append($h2, $h3,`<audio src="${music.previewUrl}" controls>
                Your browser does not support the audio element.
                </audio>`, `<button id="next">Next</button> `)
            $('#next').on('click', () => {
                if(i >= len) {
                    i = 0;
                } else {
                    i++;
                }
                generateContent(i)
            })
        }
        generateContent(i)
        })  
        
</script>


